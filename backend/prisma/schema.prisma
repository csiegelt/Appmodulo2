generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model agentes {
  id        Int         @id @default(autoincrement())
  nombre    String      @db.VarChar(100)
  email     String?     @db.VarChar(100)
  telefono  String?     @db.VarChar(20)
  contratos contratos[]
}

model archivos_propiedad {
  id             Int         @id @default(autoincrement())
  propiedad_id   Int
  nombre_archivo String      @db.VarChar(255)
  ruta_archivo   String      @db.VarChar(255)
  tipo_archivo   String?     @db.VarChar(50)
  fecha_subida   DateTime?   @default(now()) @db.DateTime(0)
  propiedades    propiedades @relation(fields: [propiedad_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "archivos_propiedad_ibfk_1")

  @@index([propiedad_id], map: "propiedad_id")
}

model campa_as {
  id                   Int                    @id @default(autoincrement())
  nombre               String                 @db.VarChar(100)
  descripcion          String?                @db.Text
  tipo                 campa_as_tipo
  fecha_inicio         DateTime               @db.Date
  fecha_fin            DateTime               @db.Date
  activa               Boolean?               @default(true)
  creado_en            DateTime               @default(now()) @db.Timestamp(0)
  campa_as_propiedades campa_as_propiedades[]

  @@map("campañas")
}

model campa_as_propiedades {
  id            Int         @id @default(autoincrement())
  id_campa_a    Int         @map("id_campaña")
  id_propiedad  Int
  precio_oferta Decimal?    @db.Decimal(12, 2)
  condiciones   String?     @db.Text
  campa_as      campa_as    @relation(fields: [id_campa_a], references: [id], onUpdate: Restrict, map: "campañas_propiedades_ibfk_1")
  propiedades   propiedades @relation(fields: [id_propiedad], references: [id], onUpdate: Restrict, map: "campañas_propiedades_ibfk_2")

  @@unique([id_campa_a, id_propiedad], map: "campaña_propiedad_uniq")
  @@index([id_propiedad], map: "id_propiedad")
  @@map("campañas_propiedades")
}

model cliente_agente {
  id                                           Int      @id @default(autoincrement())
  cliente_id                                   Int
  agente_id                                    Int
  clientes_cliente_agente_cliente_idToclientes clientes @relation("cliente_agente_cliente_idToclientes", fields: [cliente_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "cliente_agente_ibfk_1")
  clientes_cliente_agente_agente_idToclientes  clientes @relation("cliente_agente_agente_idToclientes", fields: [agente_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "cliente_agente_ibfk_2")

  @@index([agente_id], map: "agente_id")
  @@index([cliente_id], map: "cliente_id")
}

model clientes {
  id                                                 Int              @id @default(autoincrement())
  nombre                                             String           @db.VarChar(100)
  rut                                                String?          @db.VarChar(20)
  email                                              String?          @db.VarChar(100)
  telefono                                           String?          @db.VarChar(20)
  tipo                                               String?          @db.VarChar(50)
  password                                           String?          @db.VarChar(255)
  es_agente                                          Boolean          @default(false)
  cliente_agente_cliente_agente_cliente_idToclientes cliente_agente[] @relation("cliente_agente_cliente_idToclientes")
  cliente_agente_cliente_agente_agente_idToclientes  cliente_agente[] @relation("cliente_agente_agente_idToclientes")
  contratos                                          contratos[]
  propietarios                                       propietarios[]
  requerimientos                                     requerimientos[]
  visitas                                            visitas[]
}

model contratos {
  id            Int         @id @default(autoincrement())
  tipo_contrato String?     @db.VarChar(50)
  fecha_inicio  DateTime?   @db.Date
  fecha_fin     DateTime?   @db.Date
  cliente_id    Int
  propiedad_id  Int
  agente_id     Int?
  estado        String?     @db.VarChar(50)
  clientes      clientes    @relation(fields: [cliente_id], references: [id], onUpdate: Restrict, map: "Contratos_ibfk_1")
  propiedades   propiedades @relation(fields: [propiedad_id], references: [id], onUpdate: Restrict, map: "Contratos_ibfk_2")
  agentes       agentes?    @relation(fields: [agente_id], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "Contratos_ibfk_3")
  pagos         pagos[]

  @@index([agente_id], map: "agente_id")
  @@index([cliente_id], map: "cliente_id")
  @@index([propiedad_id], map: "propiedad_id")
}

model detalles_propiedad {
  id               Int         @id @default(autoincrement())
  propiedad_id     Int
  dormitorios      Int?        @default(0)
  banos            Int?        @default(0)
  estacionamientos Int?        @default(0)
  metros           Int?        @default(0)
  propiedades      propiedades @relation(fields: [propiedad_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "detalles_propiedad_ibfk_1")

  @@index([propiedad_id], map: "propiedad_id")
}

model imagenes_propiedad {
  id           Int         @id @default(autoincrement())
  propiedad_id Int
  ruta_imagen  String      @db.VarChar(255)
  propiedades  propiedades @relation(fields: [propiedad_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "imagenes_propiedad_ibfk_1")

  @@index([propiedad_id], map: "propiedad_id")
}

model pagos {
  id          Int       @id @default(autoincrement())
  contrato_id Int
  fecha_pago  DateTime? @db.Date
  monto       Decimal?  @db.Decimal(12, 2)
  metodo_pago String?   @db.VarChar(50)
  estado      String?   @db.VarChar(50)
  contratos   contratos @relation(fields: [contrato_id], references: [id], onUpdate: Restrict, map: "Pagos_ibfk_1")

  @@index([contrato_id], map: "contrato_id")
}

model propiedades {
  id                   Int                        @id @default(autoincrement())
  direccion            String                     @db.VarChar(255)
  ciudad               String?                    @db.VarChar(100)
  tipo                 String?                    @db.VarChar(50)
  estado               String?                    @db.VarChar(50)
  precio               Decimal?                   @db.Decimal(12, 2)
  tipo_moneda          String?                    @db.VarChar(10)
  condicion            String?                    @db.VarChar(10)
  descripcion          String?                    @db.Text
  fecha_publicacion    DateTime?                  @db.Date
  ruta_drive           String?                    @db.Text
  enlace_mapa          String?                    @db.Text
  tipo_operacion       propiedades_tipo_operacion @default(Venta)
  enlace_otro          String?                    @db.Text
  archivos_propiedad   archivos_propiedad[]
  campa_as_propiedades campa_as_propiedades[]
  contratos            contratos[]
  detalles_propiedad   detalles_propiedad[]
  imagenes_propiedad   imagenes_propiedad[]
  propietarios         propietarios[]
  visitas              visitas[]
}

model propietarios {
  id           Int         @id @default(autoincrement())
  cliente_id   Int
  propiedad_id Int
  fecha_inicio DateTime?   @db.Date
  fecha_fin    DateTime?   @db.Date
  clientes     clientes    @relation(fields: [cliente_id], references: [id], onUpdate: Restrict, map: "Propietarios_ibfk_1")
  propiedades  propiedades @relation(fields: [propiedad_id], references: [id], onUpdate: Restrict, map: "Propietarios_ibfk_2")

  @@index([cliente_id], map: "cliente_id")
  @@index([propiedad_id], map: "propiedad_id")
}

model requerimientos {
  id               Int       @id @default(autoincrement())
  cliente_id       Int
  ciudad_deseada   String?   @db.VarChar(100)
  sector_deseado   String?   @db.VarChar(100)
  tipo_propiedad   String?   @db.VarChar(50)
  condicion        String?   @db.VarChar(10)
  monto_disponible Decimal?  @db.Decimal(12, 2)
  tipo_moneda      String?   @db.VarChar(10)
  observaciones    String?   @db.Text
  estado           String?   @default("activo") @db.VarChar(20)
  fecha_registro   DateTime? @db.Date
  Tipo_operacion   String    @db.VarChar(50)
  clientes         clientes  @relation(fields: [cliente_id], references: [id], onUpdate: Restrict, map: "Requerimientos_ibfk_1")

  @@index([cliente_id], map: "cliente_id")
}

model tipos_cambio {
  id          Int      @id @default(autoincrement())
  tipo_moneda String   @db.VarChar(10)
  valor       Decimal  @db.Decimal(10, 4)
  fecha       DateTime @db.Date
  fuente      String?  @db.VarChar(100)
  created_at  DateTime @default(now()) @db.Timestamp(0)
}

model usuarios {
  id           Int                   @id @default(autoincrement())
  rut          String                @db.VarChar(20)
  nombres      String                @db.VarChar(100)
  apellidos    String                @db.VarChar(100)
  email        String                @unique(map: "email") @db.VarChar(150)
  direccion    String?               @db.VarChar(255)
  agente       Boolean?              @default(false)
  usuario      String                @unique(map: "usuario") @db.VarChar(50)
  password     String                @db.VarChar(255)
  tipo_usuario usuarios_tipo_usuario @default(cliente)
}

model visitas {
  id           Int         @id @default(autoincrement())
  cliente_id   Int
  propiedad_id Int
  fecha_visita DateTime?   @db.DateTime(0)
  estado       String?     @db.VarChar(50)
  clientes     clientes    @relation(fields: [cliente_id], references: [id], onUpdate: Restrict, map: "Visitas_ibfk_1")
  propiedades  propiedades @relation(fields: [propiedad_id], references: [id], onUpdate: Restrict, map: "Visitas_ibfk_2")

  @@index([cliente_id], map: "cliente_id")
  @@index([propiedad_id], map: "propiedad_id")
}

enum campa_as_tipo {
  cr_dito_directo    @map("crédito_directo")
  pago_contado
  descuento_temporal

  @@map("campañas_tipo")
}

enum usuarios_tipo_usuario {
  administrador
  cliente
  agente
}

enum propiedades_tipo_operacion {
  Venta
  Arriendo
}
